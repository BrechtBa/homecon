<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../bower_components/paper-material/paper-material.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-icons/editor-icons.html">
<link rel="import" href="../bower_components/iron-icons/image-icons.html">

<link rel="import" href="homecon-page.html">
<link rel="import" href="homecon-page-header.html">
<link rel="import" href="homecon-page-section.html">

<dom-module id="view-editor">

    <template>

        <style is="custom-style" include="iron-flex iron-flex-alignment">
        <style>
            :host {
                display: block;
            }
            paper-button{
                /*color: var(--button-text-color);
                background-color: var(--button-background-color);*/
            }
            .pages {
                height: 60px;
                margin-bottom: 16px;
                padding-left: 16px;
                padding-right: 16px;
                padding-bottom: 16px;
                padding-top: 1px;
                background-color: var(--menu-item-background-color);
            }
            .pages.active{
                color: var(--header-text-color);
                background-color: var(--header-background-color);
            }
            .shown{
                width: 20%;
                max-width: 50px;
            }
        </style>

        <homecon-web-socket-object id="websocketPagesList" cmd="list_pages" data="{{pagesList}}" auto></homecon-web-socket-object>

        <homecon-page>
            <homecon-page-header title="Editor" icon="pagebuilder_pagebuilder"></homecon-page-header>
            <homecon-page-section type="raised">
                <h2>Current pages</h2>
                <div class="horizontal layout center">
                    <div class="flex">
                        {{_pagesName(pagesPath,pagesList)}}
                    </div>
                    <div class="flex">
                        <paper-toggle-button active={{edit}}>Edit</paper-toggle-button>
                    </div>
                </div>
                
                <h2>Pages list</h2>
                <template is="dom-repeat" items="{{pagesList}}" as="pages">
                    <paper-material class$="horizontal layout center pages {{_activeClass(pages)}}" on-tap="showPages">
                        <div class="shown">
                            <template is="dom-if" if="{{_pagesShown(pagesPath,pages)}}">
                                <iron-icon icon="image:remove-red-eye"></iron-icon>
                            </template>
                        </div>
                        <div class="name flex">{{pages.name}}</div>
                        <template is="dom-if" if="{{!_pagesActive(pages)}}">
                            <paper-button raised><iron-icon icon="editor:publish"></iron-icon>publish</paper-button>
                        </template>
                    </paper-material>
                </template>


                    

            </homecon-page-section>
        </homecon-page>

    </template>

    <script>
        Polymer({
            is: 'view-editor',
            properties: {
                edit: {
                    type: 'Boolean',
                    value: false,
                    notify: true
                },
                pagesPath: {
                    type: 'String',
                    value: '',
                    notify: true,
                },
                
            },

            showPages: function(e){
                this.pagesPath = e.model.__data__.pages.id;
                this.$.websocketPagesList.send();
            },

            _pagesName: function(pagesPath,pagesList){
                var name = '';
                if(pagesPath==''){
                    // return the active pages
                    for(var i=0;i<pagesList.length;i++){
                        if(pagesList[i].active == 1){
                            name = pagesList[i].name;
                            break;
                        }
                    }
                }
                else{
                    // return the page with id==pagesPath
                    for(var i=0;i<pagesList.length;i++){
                        if(pagesList[i].id == pagesPath){
                            name = pagesList[i].name;
                            break;
                        }
                    }
                }
                return name;
            },

            _pagesShown: function(pagesPath,pages){
                if( (pagesPath=='' && pages.active==1) || pagesPath==pages.id ){
                    return true;
                }
                return false;
            },

            _pagesActive: function(pages){
                if( pages.active==1 ){
                    return true;
                }
                return false;
            },

            _activeClass: function(pages){
                if( this._pagesActive(pages) ){
                    return 'active';
                }
                return '';
            },

        });
    </script>

</dom-module>
