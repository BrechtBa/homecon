
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">


<link rel="import" href="homecon-web-socket.html">
<link rel="import" href="homecon-authentication.html">

<link rel="import" href="view-login.html">
<link rel="import" href="view-pages.html">

<link rel="import" href="homecon-pages-menu.html">
<link rel="import" href="homecon-menu-item.html">


<dom-module id="homecon-app">

    <template>

        <style>
            :host{
                display: block;
                --toolbar-background-color: #000000;
                --primary-background-color: #080808;
                --secondary-background-color: #0b0b0b;

                --primary-text-color: #ffffff;
                --secondary-text-color: #aaaaaa;

                --text-shadow-color: #111111;

                --primary-color: #f79a1f;
                
                --menu-item-background-color: #333333;
                --menu-item-text-color: #ffffff;
                --menu-item-border-color: #1f1f1f;
                --menu-item-background-color-hover: #373737;

                --button-background-color: #141414;
                --button-text-color: #ffffff;

                --header-background-color: #ffffff;
                --header-background-color-hover: #ededed;
                --header-text-color: #333333;
                --header-text-shadow-color: #f3f3f3;
                --header-border-color: #dddddd;


                --paper-dialog-background-color: var(--secondary-background-color);
                --paper-dialog-color: var(--primary-text-color);

                color: var(--primary-text-color);
            }
            app-header{
                background-color: var(--toolbar-background-color);
                color: var(--primary-text-color);
            }
            app-header paper-icon-button{
                --paper-icon-button-ink-color: white;
            }
            app-drawer{
                width: 40% !important;
                min-width: 300px;
                --app-drawer-content-container: {
                    width: 100%;
                };
            }
            app-toolbar{
                box-shadow: 0px 2px 2px 0px rgba(0, 0, 0, 0.5);
            }
            .drawer-content{
                width: 100%;
                height: 100%;
                margin-top: 64px;
                background-color: var(--secondary-background-color);
                color: #fff;
                box-shadow: 2px 2px 2px 0px rgba(0, 0, 0, 0.3);
            }
            .main-content{
                background-color: var(--primary-background-color);
            }
            div.menu{
                margin-top: 30px;
            }
            img.logo{
                height: 20px;
            }
            .hidden{
                display: none;
            }
        </style>


        <homecon-web-socket connected="{{connected}}"></homecon-web-socket>
        <homecon-authentication authenticated="{{authenticated}}" token="{{token}}" tokenPayload="{{tokenPayload}}"></homecon-authentication>

        <app-location route="{{route}}"></app-location>
        <app-route route="{{route}}" pattern="/:page" data="{{routeData}}" tail="{{subroute}}"></app-route>
        
        <app-header-layout class="fullbleed">

            <app-header fixed class$="[[menuClass]]">
                <app-toolbar>
                    <paper-icon-button icon="menu" on-tap="toggleDrawer" class$="[[menuButtonClass]]"></paper-icon-button>
                    <div title >Homecon</div>
                </app-toolbar>
            </app-header>

            <app-drawer-layout id="pagesDrawerLayout" class$="[[drawerWidthClass]]">

                <!-- Drawer -->
                <app-drawer id="pagesDrawer" class$="[[menuClass]]">
                    <div class=drawer-content>

                        <!-- Pages menu -->
                        <homecon-pages-menu sections="{{homeconSections}}" pages="{{homeconPages}}" edit="[[edit]]"></homecon-pages-menu>

                        <!-- Menu -->
                        <div class="menu">
                            <homecon-menu-item title="Settings" icon="homecon_gears" href="/settings"></homecon-menu-item>
                            <homecon-menu-item title="Users" icon="homecon_users" href="/users"></homecon-menu-item>
                            <homecon-menu-item title="Editor" icon="pagebuilder_pagebuilder" href="/editor"></homecon-menu-item>
                            <homecon-menu-item title="Logout" icon="homecon_logout" href="/logout"></homecon-menu-item>
                        </div>

                    </div>
                </app-drawer>



                <!-- Main -->
                <div class="main-content">
                    <iron-pages selected="[[page]]" attr-for-selected="name">
                        <view-login name="login" connected="{{connected}}"></view-login>
                        <view-pages name="pages" route="[[subroute]]" sections="{{homeconSections}}" pages="{{homeconPages}}" pageid="{{pageid}}" edit="[[edit]]"></view-pages>
                        <view-settings name="settings"></view-settings>
                        <view-editor name="editor" edit="{{edit}}"></view-editor>
                        <view-users name="users"></view-users>
                    </iron-pages>
                </div>

            </app-drawer-layout>
        </app-header-layout>
    </template>

    <script>
    Polymer({
        is: 'homecon-app',
        properties: {
            page: {
                type: String,
                reflectToAttribute: true,
                observer: '_pageChanged'
            },
            settings: {
                type: Object,
                value: {}
            }
        },

        observers: [
            '_routePageChanged(routeData.page)'
        ],

        ready: function(){

            // hide the menu button when the drawer is persistent
            var that = this;
            this.$.pagesDrawer.addEventListener('opened-changed',function(e){
                if(!that.$.pagesDrawer.persistent){
                    that.menuButtonClass = '';
                }
                else{
                    that.menuButtonClass = 'hidden';
                }
            });
        },

        toggleDrawer: function(){
            if(!this.$.pagesDrawer.persistent){
                this.$.pagesDrawer.toggle();
            }
        },

        _routePageChanged: function(page){

            if(!this.authenticated && page != 'login'){
                this.set('routeData.page','login');
            }

            this.page = page || 'pages';
            if(this.page=='login'){
                this.menuClass = 'hidden'
            }
            else{
                this.menuClass = ''
            }
            // close the pagesdrawer if it is not persistent
            if(!this.$.pagesDrawer.persistent){
                this.$.pagesDrawer.close();
            }

        },

        _pageChanged: function(page){
            // load page import on demand.
            this.importHref( this.resolveUrl('view-' + page + '.html'), null, null, true );
        },

        _sectionFilter: function(section){
            return function(page){
                return (page.section==section)
            }
        },
        
    });
    </script>
</dom-module>
